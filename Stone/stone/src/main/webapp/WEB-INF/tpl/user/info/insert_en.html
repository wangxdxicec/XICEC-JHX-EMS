<!DOCTYPE html>
<#import "/common/spring.ftl" as spring />
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="author" content="">

    <title><@spring.message "site"/></title>


    <#include "/common/common-js.html" />
    <!-- Custom styles for this template -->
    <link href="${resource}/bootstrap/b2/css/bootstrap.css" rel="stylesheet">
    <link href="${resource}/bootstrap/b2/css/docs.css" rel="stylesheet">
    <script src="${resource}/js/jquery.json-2.4.js"></script>
    <style type="text/css">
        .form-signin-heading {
            border-bottom: solid 3px #e1e1e1;
            padding-bottom: 10px;
            position: relative;
            line-height: 40px;
            color: #d84c31;
            font-size: 24px;
        }

        body {
            padding-top: 0px;
            padding-bottom: 40px;
        }

        .sidebar-nav {
            padding: 9px 0;
        }

        @media (max-width: 980px) {
            /* Enable use of floated navbar text */
            .navbar-text.pull-right {
                float: none;
                padding-left: 5px;
                padding-right: 5px;
            }
        }

        .nav-list > .active > a,
        .nav-list > .active > a:hover,
        .nav-list > .active > a:focus {
            color: #ffffff;
            text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.2);
            background-color: #f1b426;
        }

        a:hover, a:focus {
            color: #f1b426;
            text-decoration: underline;
        }
        a:hover, a:active {
            outline: 0;
        }
        a {
            color: #f1b426;
            text-decoration: none;
        }

    </style>
</head>
<!-- Bootstrap core CSS -->

<body>
<#include "/user/header.html" />
<!-- /.navbar -->
<div style="width: 100%">
    <div class="row-fluid" style="width: 962px;margin: 0px auto;">
        <#include "/user/left.html" />
        <div style="width: 639px;float: left;margin-left: 31px;background-color: #ffffff;padding: 20px;">
            <#include "/common/message.ftl" />
                <form class="form-horizontal" id="infoform" action="${base}/user/info" method="post" role="form"
                      enctype="multipart/form-data">
                    <div style="color: #f1b426;font-size: 16px;border-bottom: 1px #dbdbdb solid;line-height: 32px;font-weight: bolder"><@spring.message "info.insert.exhibition.title"/></div>
                    <#if rc.locale=="zh_CN">
                        <div class="alert alert-block">
                            2014.12.15截止，所提交的信息将刊登在展会会刊上。
                        </div>
                        <#else>
                            <div class="alert alert-block">
                                The information will be shown on the official catalog and mobile App.<br/>
                                Submitting Deadline: Dec 15, 2014
                            </div>
                    </#if>
                    <div style="color: red"><span style="font-weight: bolder;color: red;padding-left: 5px;">*</span>is required</div>
                    <div class="control-group">
                        <label class="control-label"><@spring.message "info.insert.exhibition.company_zh"/></label>

                        <div class="controls">
                            <input type="text" catValidate="required:false" name="company" class="form-control" placeholder='<@spring.message "info.insert.exhibition.company_zh"/>'>
                        </div>
                    </div>
                    <div class="control-group">
                        <label  class="control-label"><@spring.message "info.insert.exhibition.company_en"/></label>

                        <div class="controls">
                            <input type="text" catValidate="required:true" name="companyEn" class="form-control" 
                                   placeholder='<@spring.message "info.insert.exhibition.company_en"/>'><span style="font-weight: bolder;color: red;padding-left: 5px;">*</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label"><@spring.message "info.update.exhibition.phone"/></label>

                        <div class="controls">
                            <input placeholder="Area Number" catValidate="required:false" name="areaNumber" type="text" style="width: 60px;" />-<input catValidate="required:false" placeholder='<@spring.message "info.update.exhibition.phone"/> number' name="phoneNumber" type="text" style="width: 128px;" />
                            <span style="font-weight: bolder;color: red;padding-left: 5px;">*</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label"><@spring.message "info.update.exhibition.fax"/></label>

                        <div class="controls">
                            <input placeholder="Area Number" catValidate="required:false" name="faxAreaNumber" type="text" style="width: 60px;" />-<input catValidate="required:false" placeholder='<@spring.message "info.update.exhibition.fax"/> number' name="faxNumber" type="text" style="width: 128px;" />
                            <span style="font-weight: bolder;color: red;padding-left: 5px;">*</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class=" control-label"><@spring.message "info.insert.exhibition.email"/></label>

                        <div class="controls">
                            <input type="email" catValidate="required:true" name="email" class="form-control"  placeholder='<@spring.message "info.insert.exhibition.email"/>'><span style="font-weight: bolder;color: red;padding-left: 5px;">*</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label  class=" control-label"><@spring.message "info.insert.exhibition.website"/></label>

                        <div class="controls">
                            <input type="text" catValidate="required:true" name="website" class="form-control" 
                                   placeholder='<@spring.message "info.insert.exhibition.website"/>'><span style="font-weight: bolder;color: red;padding-left: 5px;">*</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class=" control-label"><@spring.message "info.insert.exhibition.address_zh"/></label>

                        <div class="controls">
                            <input type="text" catValidate="required:false" name="address" class="form-control"  placeholder='<@spring.message "info.insert.exhibition.address_zh"/>'>
                        </div>
                    </div>
                    <div class="control-group">
                        <label  class=" control-label"><@spring.message "info.insert.exhibition.address_en"/></label>

                        <div class="controls">
                            <input type="text" catValidate="required:true" name="addressEn" class="form-control" 
                                   placeholder='<@spring.message "info.insert.exhibition.address_zh"/>'><span style="font-weight: bolder;color: red;padding-left: 5px;">*</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class=" control-label"><@spring.message "info.insert.exhibition.zipcode"/></label>

                        <div class="controls">
                            <input type="text" catValidate="required:false" name="zipcode" class="form-control"  placeholder='<@spring.message "info.insert.exhibition.zipcode"/>'>
                        </div>
                    </div>
                    <div class="control-group">
                        <label  class=" control-label"><@spring.message "info.insert.exhibition.product_zh"/></label>

                        <div class="controls">
                            <input type="text" catValidate="required:true" name="mainProduct" class="form-control" 
                                   placeholder='<@spring.message "info.insert.exhibition.product_zh"/>'><span style="font-weight: bolder;color: red;padding-left: 5px;">*</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label  class=" control-label"><@spring.message "info.insert.exhibition.product_en"/></label>

                        <div class="controls">
                            <input type="text" catValidate="required:true" name="mainProductEn" class="form-control" 
                                   placeholder='<@spring.message "info.insert.exhibition.product_en"/>'><span style="font-weight: bolder;color: red;padding-left: 5px;">*</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label"><@spring.message "info.insert.exhibition.company_introduction_zh"/></label>

                        <div class="controls">
                            <textarea name="mark" catValidate="required:false" value="${updateInfo.mark!""}" class="form-control" id="inputEmail3"
                            placeholder='<@spring.message "info.insert.exhibition.company_introduction_zh_placeholder"/>'></textarea><span style="font-weight: bolder;color: red;padding-left: 5px;">*</span>
                            <div><@spring.message "info.insert.exhibition.company_introduction_zh_length"/></div>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label"><@spring.message "info.insert.exhibition.company_introduction_en"/></label>

                        <div class="controls">
                            <textarea name="emark" catValidate="required:true" value="${updateInfo.mark!""}" class="form-control" id="inputEmail3"
                            placeholder='<@spring.message "info.insert.exhibition.company_introduction_en_placeholder"/>'></textarea><span style="font-weight: bolder;color: red;padding-left: 5px;">*</span>
                            <div><@spring.message "info.insert.exhibition.company_introduction_en_length"/></div>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class=" control-label"><@spring.message "module.meipai"/></label>

                        <div class="controls">
                            <textarea name="meipai" catValidate="required:false" class="form-control"  placeholder='<@spring.message "module.meipai"/>'></textarea>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class=" control-label"><@spring.message "module.meipai_en"/></label>

                        <div class="controls">
                            <textarea name="meipaiEn" catValidate="required:false" class="form-control"  placeholder='<@spring.message "module.meipai_en"/>'></textarea>
                        </div>
                    </div>
                    <div class="control-group">
                        <label  class=" control-label"><@spring.message "info.insert.exhibition.logo"/></label>

                        <div class="controls">
                            <input type="file" style="width: 220px" catValidate="required:true" name="companyLogo" class="form-control" 
                                   placeholder='<@spring.message "info.insert.exhibition.logo"/>'><span style="font-weight: bolder;color: red;padding-left: 5px;">*</span>
                        </div>
                    </div>
                    <hr>
                    <div style="color: #f1b426;font-size: 16px;border-bottom: 1px #dbdbdb solid;line-height: 32px;font-weight: bolder"><@spring.message "info.products"/></div>
                    <div class="row-fluid">
                        <div style="min-width: 200px;float: left">
                            <ul class="nav nav-list bs-docs-sidenav">
                                <#list types as type>
                                    <li><a role="parent" id="${type.id}" sort="parent_${type_index}"
                                           href="javascript:void(0)">
                                        <i class="icon-chevron-right pull-right"></i>
                                        <span name="selectedCount" id="parent_count_${type.id}" count="0"
                                              class="badge pull-right hide"></span>
                                        ${type.typeName}
                                    </a>
                                    </li>
                                </#list>
                            </ul>
                        </div>
                        <div class="span5">
                            <#list types as type>
                                <div role="childContainer" sort="child_${type_index}" parentId="${type.id}"
                                     class="nav nav-list bs-docs-sidenav hide">
                                    <#list type.childrenTypes as ctype>
                                        <li><a id="subTypeId_${ctype.id}" role="child" parentId="${type.id}"
                                               subTypeId="${ctype.id}"
                                               typeName="${ctype.typeName}"
                                               parentName="${type.typeName}"
                                               other="${ctype.isOther!"0"}" href="javascript:void(0)"
                                            class="list-group-item">
                                            <i class="icon-ok pull-right hide"></i>
                                            ${ctype.typeName}
                                            </a>
                                        </li>
                                    </#list>
                                    <textarea id="child_other_${type.id}" style="margin-top: 10px;width: 245px"
                                              class="form-control hide" placeholder="其他产品类型描述"></textarea>
                                </div>
                            </#list>
                        </div>
                    </div>
                    <button type="button" style="margin-top: 10px;" name="previewCatagory" class="btn btn-warning"><@spring.message "info.update.exhibition.preview"/></button><button type="button" style="margin-top: 10px;margin-left: 10px" name="saveButton" class="btn btn-warning"><@spring.message "info.update.exhibition.save"/></button>
                    <input name="classjson" id="classjson" type="hidden">
                    <input name="phone" type="hidden" />
                    <input name="fax" type="hidden" />
                </form>
            </div>
            <!--/row-->
        </div>
        <!--/span-->

    </div>
    <!--/row-->

    <hr>

    <#include "/footer.html" />

</div>
<script>
    $(document).ready(function(){
        $("#nav_einfo").addClass("active")
    });
</script>
<script>
    selected = eval('${selected}');
    function initShowSelectedCount() {
        $("[name='selectedCount']").each(function () {
            if (parseInt($(this).attr("count")) > 0) {
                $(this).text(words.selected + parseInt($(this).attr("count")));
                $(this).removeClass("hide");
            } else {
                $(this).addClass("hide");
            }
        });
    }
    $(document).ready(function () {
        $("#leftExhibitor").addClass("lcurrent");
        //init
        $("a[sort='parent_0']").parent().addClass("active");
        $("div[sort='child_0']").removeClass("hide");
        //load exhibitor class info
        $(selected).each(function () {
            $("#parent_count_" + this.parentTypeId).attr("count", parseInt($("#parent_count_" + this.parentTypeId).attr("count")) + 1);
            $($("#subTypeId_" + this.subTypeId).children()[0]).removeClass("hide")
            if (this.isOther != null && this.isOther == 1) {
                $("#child_other_" + this.parentTypeId).removeClass("hide");
                $("#child_other_" + this.parentTypeId).text(this.otherDescription);
            }
        });
        initShowSelectedCount();
        //parent type click event handle
        $("[role='parent']").click(function () {
            $("[role='parent']").each(function () {
                $(this).parent().removeClass("active");
            });
            $(this).parent().addClass("active");
            $("[role='childContainer']").each(function () {
                $(this).addClass("hide");
            })
            $("div[parentId='" + $(this).attr("id") + "']").removeClass("hide");
        });

        //children type click event handle
        $("[role='child']").click(function () {
            if ($(this).attr("other") == 1) {
                if ($("#child_other_" + $(this).attr("parentId")).hasClass("hide")) {
                    $("#child_other_" + $(this).attr("parentId")).removeClass("hide");
                } else {
                    $("#child_other_" + $(this).attr("parentId")).addClass("hide");
                }
            }
            if ($($(this).children()[0]).hasClass("hide")) {
                $($(this).children()[0]).removeClass("hide");
                $("#parent_count_" + $(this).attr("parentId")).attr("count", parseInt($("#parent_count_" + $(this).attr("parentId")).attr("count")) + 1);
            } else {
                $($(this).children()[0]).addClass("hide");
                $("#parent_count_" + $(this).attr("parentId")).attr("count", parseInt($("#parent_count_" + $(this).attr("parentId")).attr("count")) - 1);
            }
            initShowSelectedCount();
        });
        //save event
        $("[name='saveButton']").click(function () {

            nowSelected = new Array();
            request = {"selected": nowSelected}
            //find all selected
            $("[role='child']").each(function () {
                if (!$($(this).children()[0]).hasClass("hide")) {
                    //no hide. selected
                    selectItem = {};
                    selectItem.parentTypeId = $(this).attr("parentid");
                    selectItem.subTypeId = $(this).attr("subTypeId");
                    selectItem.isOther = $(this).attr("other");
                    if (selectItem.isOther == 1) {
                        selectItem.otherDescription = $("#child_other_" + $(this).attr("parentid")).val();
                        if(selectItem.otherDescription==''){
                            alert("选择“其他”，描述不能为空")
                            return;
                        }
                    }
//                    console.log(selectItem);
                    nowSelected.push(selectItem);
                }
            });
            $("#classjson").val($.toJSON(request));
            function needValidate(o){
                var catValidate = $("#infoform [name='"+o.name+"']").attr("catValidate");
                return catValidate!=undefined&&catValidate.indexOf("required:true")!=-1;
            }
            var formData = $("#infoform").serializeArray();
            for(var i=0;i<formData.length;i++){
                if(formData[i].name=='email'){
                    if(formData[i].value==''){
                        alert(words.mailNotEmpty);
                        return;
                    }else if(!checkEmail(formData[i].value)){
                        alert(words.mailNotRight);
                        return;
                    }
                }
                if(formData[i].value==''&&needValidate(formData[i])){
                    alert($("#infoform [name='"+formData[i].name+"']").attr("placeholder")+words.isRequired);
                    return;
                }
            }
            var phone = $("[name='areaNumber']").val()+"-"+$("[name='phoneNumber']").val();
            var fax = $("[name='faxAreaNumber']").val()+"-"+$("[name='faxNumber']").val();
            $("[name='phone']").val(phone);
            $("[name='fax']").val(fax);
            $("#infoform").submit();
        });

        $("[name='previewCatagory']").click(function(){
            var selectMap = {};
            $("[role='child']").each(function () {
                if (!$($(this).children()[0]).hasClass("hide")) {
                    if(selectMap['parentId'+$(this).attr("parentid")]==undefined){
                        selectMap['parentId'+$(this).attr("parentid")] = {'parentName':$(this).attr("parentName"),'items':[]};
                    }
                    //no hide. selected
                    selectItem = {};
                    selectItem.parentTypeId = $(this).attr("parentid");
                    selectItem.subTypeId = $(this).attr("subTypeId");
                    selectItem.parentName = $(this).attr("parentName");
                    selectItem.subName = $(this).attr("typeName");
                    selectItem.isOther = $(this).attr("other");
                    if (selectItem.isOther == 1) {
                        selectItem.otherDescription = $("#child_other_" + $(this).attr("parentid")).val();
                    }
                    selectMap['parentId'+$(this).attr("parentid")].items.push(selectItem);
                }
            });
            $("#preview .modal-body").html("");
            for(var p in selectMap){
                $("#preview .modal-body").append("<h4>"+selectMap[p].parentName+"</h4>");
                var parent = $("<ul></ul>");
                for(var i in selectMap[p].items){
                    parent.append("<li>"+selectMap[p].items[i].subName+"</li>")
                }
                $("#preview .modal-body").append(parent);
            }

            $("#preview").modal();
        })
    });
</script>
<!--/.container-->
<script src="${resource}/bootstrap/b2/js/bootstrap.js"></script>
<div class="modal hide fade" id="preview" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal"><@spring.message "close"/></button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
</body>
</html>